var beehive=(()=>{var Ke=Object.create;var J=Object.defineProperty;var Je=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var ze=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty;var et=(r,o)=>()=>(o||r((o={exports:{}}).exports,o),o.exports),tt=(r,o)=>{for(var i in o)J(r,i,{get:o[i],enumerable:!0})},me=(r,o,i,l)=>{if(o&&typeof o=="object"||typeof o=="function")for(let f of Ze(o))!Qe.call(r,f)&&f!==i&&J(r,f,{get:()=>o[f],enumerable:!(l=Je(o,f))||l.enumerable});return r};var rt=(r,o,i)=>(i=r!=null?Ke(ze(r)):{},me(o||!r||!r.__esModule?J(i,"default",{value:r,enumerable:!0}):i,r)),nt=r=>me(J({},"__esModule",{value:!0}),r);var je=et((Be,Ne)=>{(function(r){var o=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},l=10,f=typeof process=="object"&&typeof process.nextTick=="function",h=typeof Symbol=="function",g=typeof Reflect=="object",b=typeof setImmediate=="function",v=b?setImmediate:setTimeout,w=h?g&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function O(){this._events={},this._conf&&A.call(this,this._conf)}function A(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function k(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),typeof process<"u"&&process.emitWarning){var s=new Error(n);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,process.emitWarning(s)}else console.error(n),console.trace&&console.trace()}var B=function(e,t,n){var s=arguments.length;switch(s){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var a=new Array(s);s--;)a[s]=arguments[s];return a}};function D(e,t){for(var n={},s,a=e.length,u=t?value.length:0,c=0;c<a;c++)s=e[c],n[s]=c<u?t[c]:r;return n}function G(e,t,n){this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0;var s,a;if((n.on||n.off)&&(s=n.on,a=n.off),t.addEventListener?(s=t.addEventListener,a=t.removeEventListener):t.addListener?(s=t.addListener,a=t.removeListener):t.on&&(s=t.on,a=t.off),!s&&!a)throw Error("target does not implement any known event API");if(typeof s!="function")throw TypeError("on method must be a function");if(typeof a!="function")throw TypeError("off method must be a function");this._on=s,this._off=a;var u=e._observers;u?u.push(this):e._observers=[this]}Object.assign(G.prototype,{subscribe:function(e,t,n){var s=this,a=this._target,u=this._emitter,c=this._listeners,m=function(){var p=B.apply(null,arguments),d={data:p,name:t,original:e};if(n){var _=n.call(a,d);_!==!1&&u.emit.apply(u,[d.name].concat(p));return}u.emit.apply(u,[t].concat(p))};if(c[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,u._newListener&&u._removeListener&&!s._onNewListener?(this._onNewListener=function(p){p===t&&c[e]===null&&(c[e]=m,s._on.call(a,e,m))},u.on("newListener",this._onNewListener),this._onRemoveListener=function(p){p===t&&!u.hasListeners(p)&&c[e]&&(c[e]=null,s._off.call(a,e,m))},c[e]=null,u.on("removeListener",this._onRemoveListener)):(c[e]=m,s._on.call(a,e,m))},unsubscribe:function(e){var t=this,n=this._listeners,s=this._emitter,a,u,c=this._off,m=this._target,p;if(e&&typeof e!="string")throw TypeError("event must be a string");function d(){t._onNewListener&&(s.off("newListener",t._onNewListener),s.off("removeListener",t._onRemoveListener),t._onNewListener=null,t._onRemoveListener=null);var _=he.call(s,t);s._observers.splice(_,1)}if(e){if(a=n[e],!a)return;c.call(m,e,a),delete n[e],--this._listenersCount||d()}else{for(u=w(n),p=u.length;p-- >0;)e=u[p],c.call(m,e,n[e]);this._listeners={},this._listenersCount=0,d()}}});function K(e,t,n,s){var a=Object.assign({},t);if(!e)return a;if(typeof e!="object")throw TypeError("options must be an object");var u=Object.keys(e),c=u.length,m,p,d;function _(S){throw Error('Invalid "'+m+'" option value'+(S?". Reason: "+S:""))}for(var L=0;L<c;L++){if(m=u[L],!s&&!o.call(t,m))throw Error('Unknown "'+m+'" option');p=e[m],p!==r&&(d=n[m],a[m]=d?d(p,_):p)}return a}function ue(e,t){return(typeof e!="function"||!e.hasOwnProperty("prototype"))&&t("value must be a constructor"),e}function ce(e){var t="value must be type of "+e.join("|"),n=e.length,s=e[0],a=e[1];return n===1?function(u,c){if(typeof u===s)return u;c(t)}:n===2?function(u,c){var m=typeof u;if(m===s||m===a)return u;c(t)}:function(u,c){for(var m=typeof u,p=n;p-- >0;)if(m===e[p])return u;c(t)}}var Z=ce(["function"]),Ye=ce(["object","function"]);function fe(e,t,n){var s,a,u=0,c,m=new e(function(p,d,_){n=K(n,{timeout:0,overload:!1},{timeout:function(T,P){return T*=1,(typeof T!="number"||T<0||!Number.isFinite(T))&&P("timeout must be a positive number"),T}}),s=!n.overload&&typeof e.prototype.cancel=="function"&&typeof _=="function";function L(){a&&(a=null),u&&(clearTimeout(u),u=0)}var S=function(T){L(),p(T)},x=function(T){L(),d(T)};s?t(S,x,_):(a=[function(T){x(T||Error("canceled"))}],t(S,x,function(T){if(c)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof T!="function")throw TypeError("onCancel callback must be a function");a.push(T)}),c=!0),n.timeout>0&&(u=setTimeout(function(){var T=Error("timeout");T.code="ETIMEDOUT",u=0,m.cancel(T),d(T)},n.timeout))});return s||(m.cancel=function(p){if(!!a){for(var d=a.length,_=1;_<d;_++)a[_](p);a[0](p),a=null}}),m}function he(e){var t=this._observers;if(!t)return-1;for(var n=t.length,s=0;s<n;s++)if(t[s]._target===e)return s;return-1}function R(e,t,n,s,a){if(!n)return null;if(s===0){var u=typeof t;if(u==="string"){var c,m,p=0,d=0,_=this.delimiter,L=_.length;if((m=t.indexOf(_))!==-1){c=new Array(5);do c[p++]=t.slice(d,m),d=m+L;while((m=t.indexOf(_,d))!==-1);c[p++]=t.slice(d),t=c,a=p}else t=[t],a=1}else u==="object"?a=t.length:(t=[t],a=1)}var S=null,x,T,P,ee,te,U=t[s],re=t[s+1],M,C;if(s===a)n._listeners&&(typeof n._listeners=="function"?(e&&e.push(n._listeners),S=[n]):(e&&e.push.apply(e,n._listeners),S=[n]));else if(U==="*"){for(M=w(n),m=M.length;m-- >0;)x=M[m],x!=="_listeners"&&(C=R(e,t,n[x],s+1,a),C&&(S?S.push.apply(S,C):S=C));return S}else if(U==="**"){for(te=s+1===a||s+2===a&&re==="*",te&&n._listeners&&(S=R(e,t,n,a,a)),M=w(n),m=M.length;m-- >0;)x=M[m],x!=="_listeners"&&(x==="*"||x==="**"?(n[x]._listeners&&!te&&(C=R(e,t,n[x],a,a),C&&(S?S.push.apply(S,C):S=C)),C=R(e,t,n[x],s,a)):x===re?C=R(e,t,n[x],s+2,a):C=R(e,t,n[x],s,a),C&&(S?S.push.apply(S,C):S=C));return S}else n[U]&&(S=R(e,t,n[U],s+1,a));if(T=n["*"],T&&R(e,t,T,s+1,a),P=n["**"],P)if(s<a)for(P._listeners&&R(e,t,P,a,a),M=w(P),m=M.length;m-- >0;)x=M[m],x!=="_listeners"&&(x===re?R(e,t,P[x],s+2,a):x===U?R(e,t,P[x],s+1,a):(ee={},ee[x]=P[x],R(e,t,{"**":ee},s+1,a)));else P._listeners?R(e,t,P,a,a):P["*"]&&P["*"]._listeners&&R(e,t,P["*"],a,a);return S}function Fe(e,t,n){var s=0,a=0,u,c=this.delimiter,m=c.length,p;if(typeof e=="string")if((u=e.indexOf(c))!==-1){p=new Array(5);do p[s++]=e.slice(a,u),a=u+m;while((u=e.indexOf(c,a))!==-1);p[s++]=e.slice(a)}else p=[e],s=1;else p=e,s=e.length;if(s>1){for(u=0;u+1<s;u++)if(p[u]==="**"&&p[u+1]==="**")return}var d=this.listenerTree,_;for(u=0;u<s;u++)if(_=p[u],d=d[_]||(d[_]={}),u===s-1)return d._listeners?(typeof d._listeners=="function"&&(d._listeners=[d._listeners]),n?d._listeners.unshift(t):d._listeners.push(t),!d._listeners.warned&&this._maxListeners>0&&d._listeners.length>this._maxListeners&&(d._listeners.warned=!0,k.call(this,d._listeners.length,_))):d._listeners=t,!0;return!0}function pe(e,t,n,s){for(var a=w(e),u=a.length,c,m,p,d=e._listeners,_;u-- >0;)m=a[u],c=e[m],m==="_listeners"?p=n:p=n?n.concat(m):[m],_=s||typeof m=="symbol",d&&t.push(_?p:p.join(this.delimiter)),typeof c=="object"&&pe.call(this,c,t,p,_);return t}function z(e){for(var t=w(e),n=t.length,s,a,u;n-- >0;)a=t[n],s=e[a],s&&(u=!0,a!=="_listeners"&&!z(s)&&delete e[a]);return u}function de(e,t,n){this.emitter=e,this.event=t,this.listener=n}de.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Ve(e,t,n){if(n===!0)a=!0;else if(n===!1)s=!0;else{if(!n||typeof n!="object")throw TypeError("options should be an object or true");var s=n.async,a=n.promisify,u=n.nextTick,c=n.objectify}if(s||u||a){var m=t,p=t._origin||t;if(u&&!f)throw Error("process.nextTick is not supported");a===r&&(a=t.constructor.name==="AsyncFunction"),t=function(){var d=arguments,_=this,L=this.event;return a?u?Promise.resolve():new Promise(function(S){v(S)}).then(function(){return _.event=L,m.apply(_,d)}):(u?process.nextTick:v)(function(){_.event=L,m.apply(_,d)})},t._async=!0,t._origin=p}return[t,c?new de(this,e,t):this]}function y(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,A.call(this,e)}y.EventEmitter2=y,y.prototype.listenTo=function(e,t,n){if(typeof e!="object")throw TypeError("target musts be an object");var s=this;n=K(n,{on:r,off:r,reducers:r},{on:Z,off:Z,reducers:Ye});function a(u){if(typeof u!="object")throw TypeError("events must be an object");var c=n.reducers,m=he.call(s,e),p;m===-1?p=new G(s,e,n):p=s._observers[m];for(var d=w(u),_=d.length,L,S=typeof c=="function",x=0;x<_;x++)L=d[x],p.subscribe(L,u[L]||L,S?c:c&&c[L])}return i(t)?a(D(t)):a(typeof t=="string"?D(t.split(/\s+/)):t),this},y.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var s=n.length,a,u=!1;if(e&&typeof e!="object")throw TypeError("target should be an object");for(;s-- >0;)a=n[s],(!e||a._target===e)&&(a.unsubscribe(t),u=!0);return u},y.prototype.delimiter=".",y.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},y.prototype.getMaxListeners=function(){return this._maxListeners},y.prototype.event="",y.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},y.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},y.prototype._once=function(e,t,n,s){return this._many(e,1,t,n,s)},y.prototype.many=function(e,t,n,s){return this._many(e,t,n,!1,s)},y.prototype.prependMany=function(e,t,n,s){return this._many(e,t,n,!0,s)},y.prototype._many=function(e,t,n,s,a){var u=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");function c(){return--t===0&&u.off(e,c),n.apply(this,arguments)}return c._origin=n,this._on(e,c,s,a)},y.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||O.call(this);var e=arguments[0],t,n=this.wildcard,s,a,u,c,m;if(e==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(n&&(t=e,e!=="newListener"&&e!=="removeListener"&&typeof e=="object")){if(a=e.length,h){for(u=0;u<a;u++)if(typeof e[u]=="symbol"){m=!0;break}}m||(e=e.join(this.delimiter))}var p=arguments.length,d;if(this._all&&this._all.length)for(d=this._all.slice(),u=0,a=d.length;u<a;u++)switch(this.event=e,p){case 1:d[u].call(this,e);break;case 2:d[u].call(this,e,arguments[1]);break;case 3:d[u].call(this,e,arguments[1],arguments[2]);break;default:d[u].apply(this,arguments)}if(n)d=[],R.call(this,d,t,this.listenerTree,0,a);else if(d=this._events[e],typeof d=="function"){switch(this.event=e,p){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:for(s=new Array(p-1),c=1;c<p;c++)s[c-1]=arguments[c];d.apply(this,s)}return!0}else d&&(d=d.slice());if(d&&d.length){if(p>3)for(s=new Array(p-1),c=1;c<p;c++)s[c-1]=arguments[c];for(u=0,a=d.length;u<a;u++)switch(this.event=e,p){case 1:d[u].call(this);break;case 2:d[u].call(this,arguments[1]);break;case 3:d[u].call(this,arguments[1],arguments[2]);break;default:d[u].apply(this,s)}return!0}else if(!this.ignoreErrors&&!this._all&&e==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},y.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||O.call(this);var e=arguments[0],t=this.wildcard,n,s,a,u,c,m;if(e==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(t&&(n=e,e!=="newListener"&&e!=="removeListener"&&typeof e=="object")){if(u=e.length,h){for(c=0;c<u;c++)if(typeof e[c]=="symbol"){s=!0;break}}s||(e=e.join(this.delimiter))}var p=[],d=arguments.length,_;if(this._all)for(c=0,u=this._all.length;c<u;c++)switch(this.event=e,d){case 1:p.push(this._all[c].call(this,e));break;case 2:p.push(this._all[c].call(this,e,arguments[1]));break;case 3:p.push(this._all[c].call(this,e,arguments[1],arguments[2]));break;default:p.push(this._all[c].apply(this,arguments))}if(t?(_=[],R.call(this,_,n,this.listenerTree,0)):_=this._events[e],typeof _=="function")switch(this.event=e,d){case 1:p.push(_.call(this));break;case 2:p.push(_.call(this,arguments[1]));break;case 3:p.push(_.call(this,arguments[1],arguments[2]));break;default:for(a=new Array(d-1),m=1;m<d;m++)a[m-1]=arguments[m];p.push(_.apply(this,a))}else if(_&&_.length){if(_=_.slice(),d>3)for(a=new Array(d-1),m=1;m<d;m++)a[m-1]=arguments[m];for(c=0,u=_.length;c<u;c++)switch(this.event=e,d){case 1:p.push(_[c].call(this));break;case 2:p.push(_[c].call(this,arguments[1]));break;case 3:p.push(_[c].call(this,arguments[1],arguments[2]));break;default:p.push(_[c].apply(this,a))}}else if(!this.ignoreErrors&&!this._all&&e==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(p)},y.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},y.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},y.prototype.onAny=function(e){return this._onAny(e,!1)},y.prototype.prependAny=function(e){return this._onAny(e,!0)},y.prototype.addListener=y.prototype.on,y.prototype._onAny=function(e,t){if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},y.prototype._on=function(e,t,n,s){if(typeof e=="function")return this._onAny(e,t),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||O.call(this);var a=this,u;return s!==r&&(u=Ve.call(this,e,t,s),t=u[0],a=u[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(Fe.call(this,e,t,n),a):(this._events[e]?(typeof this._events[e]=="function"&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,k.call(this,this._events[e].length,e))):this._events[e]=t,a)},y.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var n,s=[];if(this.wildcard){var a=typeof e=="string"?e.split(this.delimiter):e.slice();if(s=R.call(this,null,a,this.listenerTree,0),!s)return this}else{if(!this._events[e])return this;n=this._events[e],s.push({_listeners:n})}for(var u=0;u<s.length;u++){var c=s[u];if(n=c._listeners,i(n)){for(var m=-1,p=0,d=n.length;p<d;p++)if(n[p]===t||n[p].listener&&n[p].listener===t||n[p]._origin&&n[p]._origin===t){m=p;break}if(m<0)continue;return this.wildcard?c._listeners.splice(m,1):this._events[e].splice(m,1),n.length===0&&(this.wildcard?delete c._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}else(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&z(this.listenerTree),this},y.prototype.offAny=function(e){var t=0,n=0,s;if(e&&this._all&&this._all.length>0){for(s=this._all,t=0,n=s.length;t<n;t++)if(e===s[t])return s.splice(t,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(s=this._all,this._removeListener)for(t=0,n=s.length;t<n;t++)this.emit("removeListenerAny",s[t]);this._all=[]}return this},y.prototype.removeListener=y.prototype.off,y.prototype.removeAllListeners=function(e){if(e===r)return!this._events||O.call(this),this;if(this.wildcard){var t=R.call(this,null,e,this.listenerTree,0),n,s;if(!t)return this;for(s=0;s<t.length;s++)n=t[s],n._listeners=null;this.listenerTree&&z(this.listenerTree)}else this._events&&(this._events[e]=null);return this},y.prototype.listeners=function(e){var t=this._events,n,s,a,u,c;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!t)return[];for(n=w(t),u=n.length,a=[];u-- >0;)s=t[n[u]],typeof s=="function"?a.push(s):a.push.apply(a,s);return a}else{if(this.wildcard){if(c=this.listenerTree,!c)return[];var m=[],p=typeof e=="string"?e.split(this.delimiter):e.slice();return R.call(this,m,p,c,0),m}return t?(s=t[e],s?typeof s=="function"?[s]:s:[]):[]}},y.prototype.eventNames=function(e){var t=this._events;return this.wildcard?pe.call(this,this.listenerTree,[],null,e):t?w(t):[]},y.prototype.listenerCount=function(e){return this.listeners(e).length},y.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n=typeof e=="string"?e.split(this.delimiter):e.slice();return R.call(this,t,n,this.listenerTree,0),t.length>0}var s=this._events,a=this._all;return!!(a&&a.length||s&&(e===r?w(s).length:s[e]))},y.prototype.listenersAny=function(){return this._all?this._all:[]},y.prototype.waitFor=function(e,t){var n=this,s=typeof t;return s==="number"?t={timeout:t}:s==="function"&&(t={filter:t}),t=K(t,{timeout:0,filter:r,handleError:!1,Promise,overload:!1},{filter:Z,Promise:ue}),fe(t.Promise,function(a,u,c){function m(){var p=t.filter;if(!(p&&!p.apply(n,arguments)))if(n.off(e,m),t.handleError){var d=arguments[0];d?u(d):a(B.apply(null,arguments).slice(1))}else a(B.apply(null,arguments))}c(function(){n.off(e,m)}),n._on(e,m,!1)},{timeout:t.timeout,overload:t.overload})};function qe(e,t,n){n=K(n,{Promise,timeout:0,overload:!1},{Promise:ue});var s=n.Promise;return fe(s,function(a,u,c){var m;if(typeof e.addEventListener=="function"){m=function(){a(B.apply(null,arguments))},c(function(){e.removeEventListener(t,m)}),e.addEventListener(t,m,{once:!0});return}var p=function(){d&&e.removeListener("error",d),a(B.apply(null,arguments))},d;t!=="error"&&(d=function(_){e.removeListener(t,p),u(_)},e.once("error",d)),c(function(){d&&e.removeListener("error",d),e.removeListener(t,p)}),e.once(t,p)},{timeout:n.timeout,overload:n.overload})}var Q=y.prototype;if(Object.defineProperties(y,{defaultMaxListeners:{get:function(){return Q._maxListeners},set:function(e){if(typeof e!="number"||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");Q._maxListeners=e},enumerable:!0},once:{value:qe,writable:!0,configurable:!0}}),Object.defineProperties(Q,{_maxListeners:{value:l,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof define=="function"&&define.amd)define(function(){return y});else if(typeof Be=="object")Ne.exports=y;else{var Ge=new Function("","return this")();Ge.EventEmitter2=y}})()});var wt={};tt(wt,{beehiveChannel:()=>ke,loadMircoModule:()=>Ue,pause:()=>Xe,registerMircoApp:()=>De,start:()=>$e});var _e=[],W=()=>_e,ne=r=>{_e=r};var X=class{constructor(){this.styleSheetCache=new Map;this.scriptCache=new Map}setStyleSheetCache(o,i,l){return this.setCache(o,i,this.styleSheetCache,l)}getStyleSheetCache(o,i){return this.getCache(o,this.styleSheetCache,i)}setScriptCache(o,i,l){return this.setCache(o,i,this.scriptCache,l)}getScriptCache(o,i){return this.getCache(o,this.scriptCache,i)}getCache(o,i,l){l&&(l=se());let f=l.name;return!i.get(f)||!i.get(f).get(o)?!1:i.get(f).get(o)}setCache(o,i,l,f){if(!o)return!1;f||(f=se());let h=f.name;if(!l.get(h)){let g=new Map;l.set(h,g)}return l.get(h).set(o,i),!0}};var E=class{constructor(){}getStartOpts(o){if(o){if(E.startOpts&&E.startOpts[o]!==void 0)return E.startOpts[o];console.warn(`[beehive] the prorps [${o}] is not exist in startOptions`)}else return E.startOpts}setStartOpts(o,i){return typeof o=="string"?E.startOpts[o]=i:E.startOpts=o,E.startOpts}};var I=new X,se=()=>{let r=window.__CURRENT_RULE__;return Y("activeRule",r)?Y("activeRule",r)[0]:null},ie=r=>Y("activeRule",r)?Y("activeRule",r)[0]:null,be=r=>Y("activeRule",r),Y=(r,o)=>{let l=W().filter(f=>f[r]==o);return l.length?l:null},ge=r=>{let o=!1,i=W();if(new E().getStartOpts("triggerMode")==="router"){let f=window.location.pathname;if(i.forEach(h=>{h.activeRule==f&&(o=!0)}),!o||window.__CURRENT_RULE__===window.location.pathname)return!1;window.__PREV_RULE__=window.__CURRENT_RULE__,window.__CURRENT_RULE__=window.location.pathname}else{if(window.__CURRENT_RULE__===r.activeRule)return!1;window.__PREV_RULE__=window.__CURRENT_RULE__,window.__CURRENT_RULE__=r.activeRule}return!0},H=(r,o)=>fetch(r).then(async i=>{let l=await i.text();return r.endsWith(".js")||r.endsWith(".jsc")?I.setScriptCache(r,l,o):r.endsWith(".css")&&I.setStyleSheetCache(r,l,o),l}),oe=(r,o,i)=>{if(!r||!o)return;let l="",f=";";for(let b in r)we(r,b)&&(l+=`var ${b} = ${o}["${b}"];
`,f+=`${o}["${b}"] = ${b};
`);for(let b in r.windowProxy)we(r.windowProxy,b)&&(l+=`var ${b} = ${o}["${b}"];
`,f+=`${o}["${b}"] = ${b};
`);l+="try {",f+=`} catch(e) {
 console.error(e); 
}`;let h="";if(typeof i=="string")h=i;else{h=i.toString();let b=h.indexOf("{")+1,v=h.lastIndexOf("}");h=h.substring(b,v)}return l+h+f},we=(r,o)=>{let i=/^([^\x00-\xff]|[a-zA-Z_$])([^\x00-\xff]|[a-zA-Z0-9_$])*$/;return!!Object.getOwnPropertyDescriptor(r,o)&&Object.getOwnPropertyDescriptor(r,o).writable&&i.test(o)},ye=function(r){Array.from(document.getElementsByTagName("style")).forEach(i=>{i.getAttribute("app-name")===r.name&&i.remove()}),document.querySelector(r.container).shadowRoot.innerHTML=""},ve=r=>r.endsWith(".js")||r.endsWith(".jsc")?"js":"html";var N=(r,o,i)=>{let l,f=new E,h=f.getStartOpts("sandbox"),g=f.getStartOpts("cssShadowBox");if(window.__POWERED_BY_BEEHIVE__=!0,h=="nouse")l=Se(r,o);else{if(!o.proxy&&!o.shadowProxy){let b,v;g&&(v=new q(i),o.shadowProxy=v),h=="snapshot"?b=new V:b=new F(window,o.shadowProxy?o.shadowProxy.proxyDocument:null),o.proxy=b}else o.shadowProxy&&o.shadowProxy.reset(i);l=Se(r,o)}it(l)&&(o.bootstrap=l.bootstrap,o.mount=l.mount,o.unmount=l.unmount)},it=r=>r&&(r.bootstrap||r.mount||r.unmount),Se=(r,o)=>{let{name:i,proxy:l,shadowProxy:f}=o,h=new E,g=h.getStartOpts("sandbox"),b=h.getStartOpts("singular"),v=ot(i),w=i.indexOf(".")!=-1?i.split(".")[0]:i,O;g==="snapshot"||g==="nouse"?(b||console.error("[beehive] the 'SNAPSHOT | NOUSE' sandbox must be singular"),o.presets&&(window.__MIRCO_MODULE_PRESETS__=o.presets),O=`
            ${w} = {};
            ${r}

            if(${w}) return ${w}
        `):(o.presets&&(l.__MIRCO_MODULE_PRESETS__=o.presets),window.__PROXY_SANDBOX__=l,f?(window.__SHADOW_PROXY__=f.proxyDocument,O=`
            return (function(window, self, globalThis, document) {
                ${w} = {};
                ${oe(window.__PROXY_SANDBOX__,"window",r)};
                if(${w}) return ${w};
            }).bind(window.__PROXY_SANDBOX__.proxy)(window.__PROXY_SANDBOX__.proxy, window.__PROXY_SANDBOX__.proxy, window.__PROXY_SANDBOX__.proxy, window.__SHADOW_PROXY__)
        `):O=`
            return (function(window, self, globalThis) {
                ${w} = {};
                ${oe(window.__PROXY_SANDBOX__,"window",r)};
                if(${w}) return ${w};
            }).bind(window.__PROXY_SANDBOX__.proxy)(window.__PROXY_SANDBOX__.proxy, window.__PROXY_SANDBOX__.proxy, window.__PROXY_SANDBOX__.proxy)
        `);try{return console.log(o.name),new Function(O)()}catch(A){console.error(`[beehive] ${A}`)}},ot=r=>{let o="window";return r.indexOf(".")!=-1?r.split(".").forEach(l=>{o+=`['${l}']`}):o+=`['${r}']`,o};var j=class{constructor(){}};var F=class extends j{constructor(i,l){super();this.windowProxy={};this.fnRegexCheckCacheMap=new WeakMap;this.callableFnCacheMap=new WeakMap;this.boundedMap=new WeakMap;this.functionBoundedValueMap=new WeakMap;this.naughtySafari=typeof document.all=="function"&&typeof document.all>"u";this.proxy=null,this.globalContext=i||window,this.proxyDocument=l,this.active()}active(){let i=["top","parent","self","window","globalThis"],l=this;this.proxy=new Proxy(l.globalContext,{get(f,h){return i.includes(h)?h==="parent"||h==="top"?f===f[h]?this.proxy:l.globalContext[h]:l.proxy:h==="document"?document:h==="eval"?eval:typeof f[h]=="function"?!l.isConstructable(f[h])&&l.isCallable(f[h])&&!l.isBoundedFunction(f[h])?f[h].bind(f):f[h]:l.windowProxy[h]||f[h]},set(f,h,g){return l.windowProxy[h]=g,!0},getPrototypeOf(){return Reflect.getPrototypeOf(l.globalContext)}})}inactive(){this.windowProxy={}}isCallable(i){if(this.callableFnCacheMap.has(i))return!0;let l=this.naughtySafari?typeof i=="function"&&typeof i<"u":typeof i=="function";return l&&this.callableFnCacheMap.set(i,l),l}isConstructable(i){let l=i.prototype&&i.prototype.constructor===i&&Object.getOwnPropertyNames(i.prototype).length>1;if(l)return!0;if(this.fnRegexCheckCacheMap.has(i))return this.fnRegexCheckCacheMap.get(i);let f=l;if(!f){let h=i.toString(),g=/^function\b\s[A-Z].*/,b=/^class\b/;f=g.test(h)||b.test(h)}return this.fnRegexCheckCacheMap.set(i,f),f}isBoundedFunction(i){if(this.boundedMap.has(i))return this.boundedMap.get(i);let l=i.name.indexOf("bound ")===0&&!i.hasOwnProperty("prototype");return this.boundedMap.set(i,l),l}getTargetValue(i,l){if(this.isCallable(l)&&!this.isBoundedFunction(l)&&!this.isConstructable(l)){let f=this.functionBoundedValueMap.get(l);if(f)return f;let h=Function.prototype.bind.call(l,i);for(let g in l)h[g]=l[g];if(l.hasOwnProperty("prototype")&&!h.hasOwnProperty("prototype")&&Object.defineProperty(h,"prototype",{value:l.prototype,enumerable:!1,writable:!0}),typeof l.toString=="function"){let g=l.hasOwnProperty("toString")&&!h.hasOwnProperty("toString"),b=h.toString===Function.prototype.toString;if(g||b){let v=Object.getOwnPropertyDescriptor(g?l:Function.prototype,"toString");Object.defineProperty(h,"toString",{...v,...v?.get?null:{value:()=>l.toString()}})}}return h}return l}};var V=class extends j{constructor(){super();this.snapshot=new Map;this.proxy=window,this.active()}active(){for(let i in window)this.snapshot[i]=window[i]}inactive(){for(let i in window)window[i]!==this.snapshot[i]&&(window[i]=this.snapshot[i])}};var q=class extends j{constructor(i){super();this.documentProxy={};this.shadowRoot=i,this.proxyDocument=null,this.active()}active(){let i=this;this.proxyDocument=new Proxy(document,{get(f,h){return typeof f[h]=="function"?(h.indexOf("querySelector")!=-1||h.indexOf("getElement")!=-1)&&i.shadowRoot[h]?i.shadowRoot[h].bind(i.shadowRoot):f[h].bind(f):f[h]},set(){return!0}});let l=i.shadowRoot.querySelector;i.shadowRoot.querySelector=function(){return arguments[0]==="head"||arguments[0]==="body"?document.querySelector(arguments[0]):l.apply(this,arguments)}}inactive(){this.documentProxy={}}reset(i){this.shadowRoot=i,this.proxyDocument=null,this.active()}};var at=HTMLHeadElement.prototype.appendChild,lt=HTMLHeadElement.prototype.insertBefore,ut=new E;var Ee=r=>{HTMLHeadElement.prototype.appendChild=xe({rawEventHandler:at,subApp:r}),HTMLHeadElement.prototype.insertBefore=xe({rawEventHandler:lt,subApp:r})},xe=r=>async function(i,l){let f=i,{subApp:h,rawEventHandler:g}=r;if(new E().getStartOpts("pause"))return g.call(this,f,l);switch(f.tagName.toLowerCase()){case"script":let b;return f.src?b=I.getScriptCache(f.src,h)||await H(f.src,h):b=f.innerText,N(b,h),null;case"link":case"style":let v=ut.getStartOpts("cssShadowBox");if(f.setAttribute("app-name",h.name),v){document.querySelector(h.container)?document.querySelector(h.container).shadowRoot.appendChild(f):document.querySelector(`#wrap-${h.container.replace("#","")}`).shadowRoot.appendChild(f);break}default:return g.call(this,f,l)}};var Ae=async(r,o="html")=>{let i=new E,l=i.getStartOpts("cssShadowBox");switch(dt(l),Ee(r),o){case"html":await ft(r,l);break;case"js":await ct(r,l);break;default:}return r},ct=async(r,o)=>{let{entry:i,container:l}=r,f;if(I.getScriptCache(i,r)?f=I.getScriptCache(i,r):f=await H(i,r),f)if(!o)N(f,r);else{let h,g=document.querySelector(r.container.replace("#",""));if(g)h=g.shadowRoot;else{let b=document.querySelector(l),v=b.getAttribute("id"),w=document.createElement("div");b.setAttribute("id",`wrap-${v}`),w.setAttribute("id",v),h=b.shadowRoot||Re(b,"open"),h.appendChild(w)}N(f,r,h)}},ft=async(r,o)=>{let{entry:i,container:l}=r,[f,h,g]=await ht(i,r),b=document.querySelector(l);if(b.innerHTML=f,!o)g.forEach(v=>{let w=Array.from(document.getElementsByTagName("style")),O=[];if(w.forEach(k=>{O.push(k)}),O.includes(v))return;let A=document.createElement("style");A.textContent=v,A.setAttribute("app-name",r.name),document.head.appendChild(A)}),h.forEach(v=>{v&&N(v,r)});else{let v=b,w,O=v.innerHTML;v.innerHTML="",w=v.shadowRoot||Re(v,"open"),w.innerHTML=O,g.forEach(A=>{let k=Array.from(document.getElementsByTagName("style")),B=[];if(k.forEach(G=>{B.push(G)}),B.includes(A))return;let D=document.createElement("style");D.textContent=A,D.setAttribute("app-name",r.name),w.appendChild(D)}),h.forEach(A=>{A&&N(A,r,w)})}},ht=async(r,o)=>{let i=await H(r,o),l=document.createElement("div");l.innerHTML=i;let[f,h,g,b,v]=await pt(l,r),w=[],O=[];return g.length&&(w=await Promise.all(g.map(async A=>{if(A.endsWith(".js")||A.endsWith(".jsc"))return I.getScriptCache(A,o)?I.getScriptCache(A,o):H(A,o)}))),v.length&&(O=await Promise.all(v.map(async A=>{if(A.endsWith(".css"))return I.getStyleSheetCache(A,o)?I.getStyleSheetCache(A,o):H(A,o)}))),h=h.concat(w),b=b.concat(O),[f,h,b]},pt=(r,o)=>{let i=[],l=[],f=[],h=[],g=[];return Te(r,o,i,l,h,g),[r.innerHTML,i,l,h,g]},Te=(r,o,i,l,f,h)=>{let g=r.parentNode,b=r.childNodes;if(r.nodeName.toLowerCase()=="script"){let v=r.src;v?v.startsWith("http")?l.push(v):l.push(`http:${o}/${v}`):i.push(r.innerHTML),g&&g.replaceChild(document.createComment("script is replaced by beehive"),r)}if(r.nodeName.toLowerCase()=="style"&&(f.push(r.innerHTML),g&&g.replaceChild(document.createComment("stylesheet is replaced by beehive"),r)),r.nodeName.toLowerCase()=="link"){let v=r.rel,w=r.href;["preload","prefetch"].includes(v)?r.remove():(w?w.startsWith("http")?((w.endsWith(".js")||w.endsWith(".jsc"))&&l.push(w),w.endsWith(".css")&&h.push(w)):((w.endsWith(".js")||w.endsWith(".jsc"))&&l.push(`http:${o}/${w}`),w.endsWith(".css")&&h.push(`http:${o}/${w}`)):i.push(r.outerHTML),g&&g.replaceChild(document.createComment("script is replaced by beehive"),r))}b&&b.length&&Array.from(b).forEach(v=>{Te(v,o,i,l,f,h)})},Re=(r,o)=>{let i;return r.attachShadow?i=r.attachShadow({mode:o}):i=r.createShadowRoot(),i},dt=r=>{let o=document.head.attachShadow||document.head.createShadowRoot;return r&&!o&&console.error("[beehive]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!"),o};var Pe,mt=()=>Pe,Ce=r=>{Pe=r},Ie=async()=>{let r=new E,o=r.getStartOpts("cssShadowBox");if(r.getStartOpts("singular")){let l=ie(window.__PREV_RULE__),f=ie(window.__CURRENT_RULE__);if(!f)return;if(l&&(l.proxy.inactive&&l.proxy.inactive(),o&&l.shadowProxy.inactive&&l.shadowProxy.inactive(),await _t(l)),f){let h=await Oe(f);await Le(h,l)}}else{window.__REGISTER_MIRCO_APPS__||(window.__REGISTER_MIRCO_APPS__=new Set);let l=be(window.__CURRENT_RULE__);for(let f=0;f<l.length;f++){window.__REGISTER_MIRCO_APPS__.add(l[f]);let h=await Oe(l[f]);await Le(h)}}},Oe=async r=>{await ae("beforeLoad",r);let o=ve(r.entry),i=await Ae(r,o);return r&&r.bootstrap&&r.bootstrap(r.props),i},Le=async(r,o)=>{r&&r.mount&&r.mount(),await ae("mounted",r),o&&ye(o)},_t=async r=>{r&&r.unmount&&r.unmount(),await ae("destroyed",r)},ae=async(r,o)=>{let i=mt();i&&i[r]&&i[r].length&&await Promise.all(i[r].map(async l=>{await l(o)}))};var $=async r=>{!ge(r)||await Ie()};var le=function(r,o){return function(){let i=new Event(o);r.apply(this,arguments),window.dispatchEvent(i)}};var Me=()=>{window.history.pushState=le(window.history.pushState,"mirco_router_push"),window.history.replaceState=le(window.history.replaceState,"mirco_router_replace"),window.addEventListener("mirco_router_push",$),window.addEventListener("mirco_router_replace",$),window.onpopstate=function(){$()}};var He=rt(je());var ke=new He.EventEmitter2,De=(r,o)=>{Array.isArray(r)?ne(r):ne([r]),Ce(o)},$e=(r={})=>{We(r),r.triggerMode==="router"&&Me()},Ue=(r,o)=>{We(o);let i=W();return i.filter(f=>f.name===r.name).length||i.push(r),$(r)},We=r=>(r?(r.prefetch=r.prefetch||!1,r.sandbox=r.sandbox||"proxy",r.singular=typeof r.singular=="boolean"?r.singular:!0,r.cssShadowBox=!!r.cssShadowBox,r.triggerMode=r.triggerMode||"router",r.pause=!1,new E().setStartOpts(r)):r=new E().getStartOpts(),r),Xe=()=>{new E().setStartOpts("pause",!0)};return nt(wt);})();
/*!
 * Beehive
 *
 * Copyright (c) 2022 Max Yao
 * Licensed under the MIT license.
 */
